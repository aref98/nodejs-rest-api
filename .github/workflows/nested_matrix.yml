name: Test Advanced Matrix Strategies

on:
  workflow_dispatch:

jobs:
  test-nested-lists:
    runs-on: ubuntu-latest
    strategy:
      matrix:
        # 'param' is the first <matrix_var>
        param:
          # The list below corresponds to the first <index>
          - name: "config_set_1"
            # 'nested_groups' is the second <matrix_var>
            nested_groups:
              # The outer list below corresponds to the second <index>
              - # The inner list below corresponds to the third <index>
                - "value_A"
                - "value_B"
              - - "value_C"
                - "value_D"

    steps:
      - name: "Print nested value"
        # This demonstrates how to access a value from the nested list-of-lists
        run: echo "Value is ${{ matrix.param.nested_groups[0][0] }}"

  test-matrix-exclude:
    runs-on: ubuntu-latest
    strategy:
      matrix:
        # Define the base matrix axes
        os: [ubuntu-latest, windows-latest]
        version: [1.0, 2.0]

        # 'exclude' is a schema keyword
        exclude:
          # This list provides the <index>
          - # First map in the list
            # 'os_config' is the first <matrix_var>
            version:
              # 'details' is the second <matrix_var>
              details:
                # 'patch' is the third <matrix_var>
                patch: "special-patch-for-ubuntu"
            # We must also specify a value for one of the axes to make the exclusion match
            os: ubuntu-latest
      
    steps:
      - name: "Run on non-excluded configurations"
        run: |
          echo "Running on OS: ${{ matrix.os }} with version: ${{ matrix.version }}"
          echo "The excluded config was os_config.details.patch: special-patch-for-ubuntu on ubuntu-latest"
